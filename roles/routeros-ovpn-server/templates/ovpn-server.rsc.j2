/log warning "Ansible is configuring OpenVPN Server now..."

/interface list
:if ([/interface list find name={{ ros_ovpn_srv_profile }}] ="") do={
    /interface list add name={{ ros_ovpn_srv_profile }};
    :put "Interface List Added"} else={
    :put "Interface List already exists"
}

/ppp profile
:if ([/ppp profile find name={{ ros_ovpn_srv_profile }}] ="") do={
    /ppp profile add name={{ ros_ovpn_srv_profile }} local-address={{ ros_ovpn_srv_vpn_subnet | ipaddr('net') | ipaddr('-1') | ipaddr('address') }} address-list={{ ros_ovpn_srv_profile }} interface-list={{ ros_ovpn_srv_profile }};
    :put "PPP Profile Added"} else={
    :put "PPP Profile already exists"
}

/interface ovpn-server server set enabled=yes default-profile={{ ros_ovpn_srv_profile }} mode=ip require-client-certificate=yes auth=sha1,md5 cipher=aes256 certificate={{ ros_ovpn_srv_certificate }}

/ip firewall filter
:if ([/ip firewall filter find comment=OVPN_server] ="") do={
    /ip firewall filter add action=accept chain=WAN-Input-Allow comment=OVPN_server dst-port=1194 protocol=tcp
    :put "Firewall rule Added"} else={
    :put "Firewall rule already exists"
}

/log warning "Ansible have configured OpenVPN Server"
